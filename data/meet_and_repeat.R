# 03.12.2020
# Data wrangling for #week 6
# Rita Beigaite
################################################################################
# Loading the libraries
library(tidyr)
library(dplyr)

# Reading the data sets (BPRS and RATS) from the GitHub repository of MABS
  
BPRS  <- read.table('https://raw.githubusercontent.com/KimmoVehkalahti/MABS/master/Examples/data/BPRS.txt', sep = " ", header = T)
RATS <- read.table('https://raw.githubusercontent.com/KimmoVehkalahti/MABS/master/Examples/data/rats.txt', sep = "\t", header = T)

# Checking the variable names of the data sets
names(RATS)
#[1] "ID"    "Group" "WD1"   "WD8"   "WD15"  "WD22"  "WD29"  "WD36"  "WD43"  "WD44" 
#[11] "WD50"  "WD57"  "WD64"

names(BPRS)
#[1] "treatment" "subject"   "week0"     "week1"     "week2"     "week3"    
#[7] "week4"     "week5"     "week6"     "week7"     "week8" 


# Checking the structure of the data sets

str(RATS)
#'data.frame':	16 obs. of  13 variables:
#  $ ID   : int  1 2 3 4 5 6 7 8 9 10 ...
#$ Group: int  1 1 1 1 1 1 1 1 2 2 ...
#$ WD1  : int  240 225 245 260 255 260 275 245 410 405 ...
#$ WD8  : int  250 230 250 255 260 265 275 255 415 420 ...
#$ WD15 : int  255 230 250 255 255 270 260 260 425 430 ...
#$ WD22 : int  260 232 255 265 270 275 270 268 428 440 ...
#$ WD29 : int  262 240 262 265 270 275 273 270 438 448 ...
#$ WD36 : int  258 240 265 268 273 277 274 265 443 460 ...
#$ WD43 : int  266 243 267 270 274 278 276 265 442 458 ...
#$ WD44 : int  266 244 267 272 273 278 271 267 446 464 ...
#$ WD50 : int  265 238 264 274 276 284 282 273 456 475 ...
#$ WD57 : int  272 247 268 273 278 279 281 274 468 484 ...
#$ WD64 : int  278 245 269 275 280 281 284 278 478 496 ...

str(BPRS)
#'data.frame':	40 obs. of  11 variables:
#  $ treatment: int  1 1 1 1 1 1 1 1 1 1 ...
#$ subject  : int  1 2 3 4 5 6 7 8 9 10 ...
#$ week0    : int  42 58 54 55 72 48 71 30 41 57 ...
#$ week1    : int  36 68 55 77 75 43 61 36 43 51 ...
#$ week2    : int  36 61 41 49 72 41 47 38 39 51 ...
#$ week3    : int  43 55 38 54 65 38 30 38 35 55 ...
#$ week4    : int  41 43 43 56 50 36 27 31 28 53 ...
#$ week5    : int  40 34 28 50 39 29 40 26 22 43 ...
#$ week6    : int  38 28 29 47 32 33 30 26 20 43 ...
#$ week7    : int  47 28 25 42 38 27 31 25 23 39 ...
#$ week8    : int  51 28 24 46 32 25 31 24 21 32 ...


#Looking at the summaries of the variables

summary(RATS)
#ID            Group           WD1             WD8             WD15      
#Min.   : 1.00   Min.   :1.00   Min.   :225.0   Min.   :230.0   Min.   :230.0  ...
#1st Qu.: 4.75   1st Qu.:1.00   1st Qu.:252.5   1st Qu.:255.0   1st Qu.:255.0  ...
#Median : 8.50   Median :1.50   Median :340.0   Median :345.0   Median :347.5  ...
#Mean   : 8.50   Mean   :1.75   Mean   :365.9   Mean   :369.1   Mean   :372.5  ...
#3rd Qu.:12.25   3rd Qu.:2.25   3rd Qu.:480.0   3rd Qu.:476.2   3rd Qu.:486.2  ...
#Max.   :16.00   Max.   :3.00   Max.   :555.0   Max.   :560.0   Max.   :565.0  ...

summary(BPRS)
#treatment      subject          week0           week1           week2     
#Min.   :1.0   Min.   : 1.00   Min.   :24.00   Min.   :23.00   Min.   :26.0  ... 
#1st Qu.:1.0   1st Qu.: 5.75   1st Qu.:38.00   1st Qu.:35.00   1st Qu.:32.0  ...
#Median :1.5   Median :10.50   Median :46.00   Median :41.00   Median :38.0  ...
#Mean   :1.5   Mean   :10.50   Mean   :48.00   Mean   :46.33   Mean   :41.7  ...
#3rd Qu.:2.0   3rd Qu.:15.25   3rd Qu.:58.25   3rd Qu.:54.25   3rd Qu.:49.0  ...
#Max.   :2.0   Max.   :20.00   Max.   :78.00   Max.   :95.00   Max.   :75.0  ...



# Converting categorical variables to factors

BPRS$treatment <- factor(BPRS$treatment)
BPRS$subject <- factor(BPRS$subject)
RATS$Group <- factor(RATS$Group)
RATS$ID <- factor(RATS$ID)


# Converting BPRS to long form

BPRSL <-  BPRS %>% gather(key = weeks, value = bprs, -treatment, -subject)
# Extracting the week number
BPRSL <-  BPRSL %>% mutate(week = as.integer(substr(weeks,5,5)))



# Converting RATS to long form

RATSL <- RATS %>%
  gather(key = WD, value = Weight, -ID, -Group) %>%
  mutate(Time = as.integer(substr(WD,3,4))) 


# Taking a glimpse at the data
glimpse(BPRSL)

Rows: 360
Columns: 5
#$ treatment <fct> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2...
#$ subject   <fct> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 1...
#$ weeks     <chr> "week0", "week0", "week0", "week0", "week0", "week0", "week0", "...
#$ bprs      <int> 42, 58, 54, 55, 72, 48, 71, 30, 41, 57, 30, 55, 36, 38, 66, 41, ...
#$ week      <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...

glimpse(RATS) 
#Rows: 16
#Columns: 13
#$ ID    <fct> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16
#$ Group <fct> 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3
#$ WD1   <int> 240, 225, 245, 260, 255, 260, 275, 245, 410, 405, 445, 555, 470, 535...
#$ WD8   <int> 250, 230, 250, 255, 260, 265, 275, 255, 415, 420, 445, 560, 465, 525...
#$ WD15  <int> 255, 230, 250, 255, 255, 270, 260, 260, 425, 430, 450, 565, 475, 530...
#$ WD22  <int> 260, 232, 255, 265, 270, 275, 270, 268, 428, 440, 452, 580, 485, 533...
#$ WD29  <int> 262, 240, 262, 265, 270, 275, 273, 270, 438, 448, 455, 590, 487, 535...
#$ WD36  <int> 258, 240, 265, 268, 273, 277, 274, 265, 443, 460, 455, 597, 493, 540...
#$ WD43  <int> 266, 243, 267, 270, 274, 278, 276, 265, 442, 458, 451, 595, 493, 525...
#$ WD44  <int> 266, 244, 267, 272, 273, 278, 271, 267, 446, 464, 450, 595, 504, 530...
#$ WD50  <int> 265, 238, 264, 274, 276, 284, 282, 273, 456, 475, 462, 612, 507, 543...
#$ WD57  <int> 272, 247, 268, 273, 278, 279, 281, 274, 468, 484, 466, 618, 518, 544...
#$ #WD64  <int> 278, 245, 269, 275, 280, 281, 284, 278, 478, 496, 472, 628, 525, 559...



# Writing the data

write.csv(BPRSL, file = "BPRSL.csv")
write.csv(RATSL, file = "RATSL.csv")

write.csv(BPRS, file = "BPRS.csv")
write.csv(RATS, file = "RATS.csv")









